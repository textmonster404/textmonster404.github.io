<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>OML Editor</title>
        <link rel="icon" href="icon/icon.ico">
        <style>
            #editor {border:1px solid black;height:20em;overflow-y:scroll;font-family:monospace;}
            #outer1 {border:2px outset #bbb;}
        </style>
        <style media="print">
            #hr {display:none;}
            #outer2 {display:none;}
            #outer1 {border:0px solid black;}
            #editor {border:0px solid black;overflow-y:initial;height:auto;}
            #back {display:none;}
        </style>
    </head>
    <body>
        <div id="outer1">
            <div style="text-align:justify;margin-top:0em;" id="outer2">
                <input type="button" value="Background" onClick="bg=document.getElementById('bac').value;document.getElementById('editor').style.background='url('+bg+')';"><input id="bac"> | <input type="button" value="Bold" style="font-weight:bold;" onClick="document.execCommand('bold',false,null);"><input type="button" value="Italic" style="font-style:italic;" onClick="document.execCommand('italic',false,null);"><input type="button" value="Underline" style="text-decoration:underline;" onClick="document.execCommand('underline',false,null);"><input type="button" value="Strike" style="text-decoration:line-through;" onClick="document.execCommand('strikeThrough',false,null);"> | <input type="button" value="Smaller" onClick="document.execCommand('decreaseFontSize',false,null);"><input type="button" value="Bigger" onClick="document.execCommand('increaseFontSize',false,null);"> | <input type="button" value="Header 1" onClick="document.execCommand('formatBlock',false,'<H1>');"><input type="button" value="Header 2" onClick="document.execCommand('formatBlock',false,'<H2>');"><input type="button" value="Header 3" onClick="document.execCommand('formatBlock',false,'<H3>');"><input type="button" value="Header 4" onClick="document.execCommand('formatBlock',false,'<H4>');"><input type="button" value="Header 5" onClick="document.execCommand('formatBlock',false,'<H5>');"><input type="button" value="Header 6" onClick="document.execCommand('formatBlock',false,'<H6>');"> | <input type="button" value="Bullet Point" onClick="document.execCommand('insertHTML',false,'&nbsp;\u2022&nbsp;');"> | <input type="button" value="Justify Center" onClick="document.execCommand('justifyCenter',false,null);"><input type="button" value="Justify Right" onClick="document.execCommand('justifyRight',false,null);"> | <sup><input type="button" value="Superscript" onClick="document.execCommand('superscript',false,null);"></sup><sub><input type="button" value="Subscript" onClick="document.execCommand('subscript',false,null);"></sub> | <input type="button" value="Tab" onClick="document.execCommand('insertHTML',false,'&nbsp;&nbsp;&nbsp;&nbsp;');"><input type="button" value="Insert Horizontal Line" onClick="document.execCommand('insertHorizontalRule',false,null);"> | <input style="text-decoration:underline;color:blue;" type="button" value="Link" onClick="document.execCommand('createlink',false,document.getElementById('link').value);"><input id="link"> | <input type="button" value="Image" onClick="document.execCommand('insertImage',false,document.getElementById('image').value);"><input id="image"> | <input type="button" value="Add Table" onClick="document.execCommand('insertHTML',false,table());"><input type="number" id="cols" value="1"><input type="number" id="rows" value="1"> | <input type="button" value="Copy" onClick="document.execCommand('copy',false,null);"> | <input type="button" value="Cut" onClick="document.execCommand('cut',false,null);"> | <input type="button" value="Paste" onClick="document.execCommand('paste',false,null);"> | <input type="button" value="Undo" onClick="document.execCommand('undo',false,null);"> | <input type="button" value="Redo" onClick="document.execCommand('redo',false,null);"> | <input type="button" value="Select All" onClick="document.execCommand('selectAll',false,null);"> | <input type="button" value="Remove Formatting" onClick="document.execCommand('removeFormat',false,null);">
            </div>
            <hr id="hr">
            <div id="editor" contenteditable></div>
            <b>File Name:</b> <input id="in" value="doc"/>.oml<br/>
            <a href="" download="" id="dl">Save</a>
            <script>
		var bg = "";
                var tables=document.getElementById("editor").getElementsByTagName("table");
                var cells=document.getElementById("editor").getElementsByTagName("td");
                var table = function() {
                    var str = "<table border=1>";
                    for (var i=0;i<document.getElementById("rows").value;i++) {str+="<tr>";for (var j=0;j<document.getElementById("cols").value;j++) {str+="<td>&nbsp;</td>";};str+="</tr>";}
                    str+="</table>";
                    return(str)
                }
                String.prototype.replaceAll = function(search, replacement) {
                    var target = this;
                    return target.split(search).join(replacement);
                };
		    
                var un_oml = function(value) {
                    return bg + "\\\\\\\\" + value.replaceAll("\n","")
                        .replaceAll("<h6>","<------")
                        .replaceAll("</h6>","------>")
                        .replaceAll("<h5>","<-----")
                        .replaceAll("</h5>","----->")
                        .replaceAll("<h4>","<----")
                        .replaceAll("</h4>","---->")
                        .replaceAll("<h3>","<---")
                        .replaceAll("</h3>","--->")
                        .replaceAll("<h2>","<--")
                        .replaceAll("</h2>","-->")
                        .replaceAll("<h1>","<-")
                        .replaceAll("</h1>","->")
                        .replaceAll("<a href=\"","<[")
                        .replaceAll("</a>","]>")
                        .replaceAll("<div style=\"text-align: center;\">","{-")
                        .replaceAll("</div>","-}")
                        .replaceAll("<div style=\"text-align: right;\">","[-")
                        .replaceAll("<table border=1>","1[==")
                        .replaceAll("<table border=0>","0[==")
                        .replaceAll("</table>","==]")
                        .replaceAll("<tr>","[=")
                        .replaceAll("</tr>","=]")
                        .replaceAll("<td>","[")
                        .replaceAll("</td>","]")
                        .replaceAll("<b><u><big>","<**_&")
                        .replaceAll("</big></u></b>","&_**>")
                        .replaceAll("<i><b>","<***")
                        .replaceAll("</b></i>","***>")
                        .replaceAll("<b><i>","<**-*")
                        .replaceAll("</i></b>","*-**>")
                        .replaceAll("<sup><b>","<^**")
                        .replaceAll("</b></sup>","**^>")
                        .replaceAll("<b><u>","<**_")
                        .replaceAll("</u></b>","_**>")
                        .replaceAll("<u>","<_")
                        .replaceAll("</u>","_>")
                        .replaceAll("<b>","<**")
                        .replaceAll("</b>","**>")
                        .replaceAll("<i>","<*")
                        .replaceAll("</i>","*>")
                        .replaceAll("<strike>","<~")
                        .replaceAll("</strike>","~>")
                        .replaceAll("<sub>","<.")
                        .replaceAll("</sub>",".>")
                        .replaceAll("<sup>","<^")
                        .replaceAll("</sup>","^>")
                        .replaceAll("<big><big><big>","<&&&")
                        .replaceAll("</big></big></big>","&&&>")
                        .replaceAll("<big><big>","<&&")
                        .replaceAll("</big></big>","&&>")
                        .replaceAll("<big>","<&")
                        .replaceAll("</big>","&>")
                        .replaceAll("<small>","<,")
                        .replaceAll("</small>",",>")
                        .replaceAll("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u2022&nbsp;","##*")
                        .replaceAll("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u2022&nbsp;","#*")
                        .replaceAll("&nbsp;\u2022&nbsp;","*")
                        .replaceAll("<hr id=\"null\">","--")
                        .replaceAll("<hr>","--")
                        .replaceAll("&nbsp;&nbsp;&nbsp;&nbsp;","##")
                        .replaceAll("<img src=\"","<@")
                        .replaceAll("\"/>","@>")
                        .replaceAll("\" width=\"","@")
                        .replaceAll("<br>","@@")
                        .replaceAll("<div>","<\\")
                        .replaceAll("<code>","")
                        .replaceAll("</code>","")
                        .replaceAll("\">","]|[")
                }
                function oml(string) {
	return "<div><code>" + string.replaceAll("\n","<br/>")
        .replaceAll("<------","<h6>")
        .replaceAll("------>","</h6>")
        .replaceAll("<-----","<h5>")
        .replaceAll("----->","</h5>")
        .replaceAll("<----","<h4>")
        .replaceAll("---->","</h4>")
        .replaceAll("<---","<h3>")
        .replaceAll("--->","</h3>")
        .replaceAll("<--","<h2>")
        .replaceAll("-->","</h2>")
        .replaceAll("<-","<h1>")
        .replaceAll("->","</h1>")
        .replaceAll("<[","<a href=\"")
        .replaceAll("]|[","\">")
        .replaceAll("]>","</a>")
        .replaceAll("[-","<div style='text-align:right;'>")
        .replaceAll("-]","</div>")
        .replaceAll("{-","<div style='text-align:center;'>")
        .replaceAll("-}","</div>")
	.replaceAll("1[==","<table border=1>")
	.replaceAll("0[==","<table border=0>")
	.replaceAll("==]","</table>")
	.replaceAll("[=","<tr>")
	.replaceAll("=]","</tr>")
	.replaceAll("[","<td>")
	.replaceAll("]","</td>")
        .replaceAll("<**_&","<b><u><big>")
        .replaceAll("&_**>","</big></u></b>")
        .replaceAll("<***","<i><b>")
        .replaceAll("***>","</b></i>")
        .replaceAll("<**-*","<b><i>")
        .replaceAll("*-**>","</i></b>")
        .replaceAll("<^**","<sup><b>")
        .replaceAll("**^>","</b></sup>")
        .replaceAll("<**_","<b><u>")
        .replaceAll("_**>","</u></b>")
        .replaceAll("<_","<u>")
        .replaceAll("_>","</u>")
        .replaceAll("<**","<b>")
        .replaceAll("**>","</b>")
        .replaceAll("<*","<i>")
        .replaceAll("*>","</i>")
        .replaceAll("<~","<s>")
        .replaceAll("~>","</s>")
        .replaceAll("<.","<sub>")
        .replaceAll(".>","</sub>")
        .replaceAll("<^","<sup>")
        .replaceAll("^>","</sup>")
        .replaceAll("<&","<big>")
        .replaceAll("&>","</big>")
        .replaceAll("<&&","<big><big>")
        .replaceAll("&&>","</big></big>")
        .replaceAll("<&&&","<big><big><big>")
        .replaceAll("&&&>","</big></big></big>")
        .replaceAll("<,","<small>")
        .replaceAll(",>","</small>")
        .replaceAll("--","<hr/>")
	.replaceAll("##","&nbsp;&nbsp;&nbsp;&nbsp;")
	.replaceAll("@@","<br/>")
	.replaceAll("<@","<img src=\"")
	.replaceAll("@>","\"/>")
	.replaceAll("@","\" width=\"")
	.replaceAll("<\\","<div>")
	.replaceAll("##*","&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u2022&nbsp;")
	.replaceAll("#*","&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u2022&nbsp;")
        .replaceAll("***","&nbsp;\u2023&nbsp;")
        .replaceAll("**","&nbsp;\u25CB&nbsp;")
        .replaceAll("*","&nbsp;\u2022&nbsp;")
        + "</code></div>";
}
                window.setInterval(function(){document.getElementById("dl").href = "data:text/plain;charset=UTF-8," + encodeURIComponent(un_oml(document.getElementById("editor").innerHTML));document.getElementById("dl").download = encodeURIComponent(document.getElementById("in").value+".oml");},0);
            </script>
            <form id="myform">
                <p>
                    <input id="myfile" name="files[]" type="file" accept=".oml" />
                </p>
            </form>
        </div>
        <script>
            document.forms['myform'].elements['myfile'].onchange = function(evt) {
                if(!window.FileReader) return; // Browser is not compatible
                var reader = new FileReader();
                reader.onload = function(evt) {
                    if(evt.target.readyState != 2) return;
                    if(evt.target.error) {
                        alert('Error while reading file');
                        return;
                    }
                    filecontent = evt.target.result;
                    if (document.getElementById("myfile").value.includes(".oml")) {
                        document.getElementById("editor").innerHTML = oml(evt.target.result).split("\\\\\\\\")[1];
                        document.getElementById("editor").style.background = "url("+oml(evt.target.result).split("\\\\\\\\")[0]+")";
                    }
                };
                reader.readAsText(evt.target.files[0]);
            };
        </script>
        <a href="OML.html" id="back">Back</a>
    </body>
</html>
